<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>灵感 & 待办空间</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --note-color: #fff7d1;
            --note-shadow: rgba(0,0,0,0.1);
            --text-color: #333;
            --accent-color: #6c5ce7;
            --done-color: #a29bfe;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            height: 100vh;
            overflow: hidden; /* 防止滚动 */
            display: flex;
        }

        /* === 左侧区域 (便签活动区) === */
        #left-area {
            flex: 1;
            position: relative;
            border-right: 1px dashed #ccc;
            background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* 可拖动便签 */
        .sticky-note {
            position: absolute;
            top: 100px;
            left: 100px;
            width: 250px;
            height: 300px;
            background-color: var(--note-color);
            box-shadow: 5px 5px 15px var(--note-shadow);
            border-radius: 2px 2px 15px 2px; /* 右下角稍微卷起 */
            display: flex;
            flex-direction: column;
            transform: rotate(-2deg);
            transition: box-shadow 0.2s;
        }

        .sticky-note:hover {
            box-shadow: 8px 8px 20px rgba(0,0,0,0.15);
            z-index: 10;
        }

        .note-header {
            height: 30px;
            background-color: rgba(0,0,0,0.05);
            cursor: move; /* 拖动光标 */
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 12px;
            user-select: none;
        }

        .note-content {
            flex: 1;
            padding: 15px;
            border: none;
            outline: none;
            resize: none;
            background: transparent;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            font-size: 16px;
            line-height: 1.5;
            color: #444;
        }

        /* === 右侧区域 (待办清单) === */
        #right-area {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 40px;
            background-color: white;
        }

        /* 顶部日期栏 */
        .header-bar {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 30px;
        }

        #date-picker {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            color: #555;
            outline: none;
            background: #f9f9f9;
            cursor: pointer;
        }

        /* 待办输入 */
        .todo-input-container {
            margin-bottom: 20px;
        }

        #new-todo {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: none;
            border-bottom: 2px solid #eee;
            outline: none;
            transition: border-color 0.3s;
        }

        #new-todo:focus {
            border-bottom-color: var(--accent-color);
        }

        /* 待办列表 */
        #todo-list {
            list-style: none;
            padding: 0;
            margin: 0;
            flex: 1;
            overflow-y: auto;
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            animation: fadeIn 0.3s ease;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 4px;
            margin-right: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox:hover {
            border-color: var(--accent-color);
        }

        .todo-text {
            font-size: 16px;
            color: var(--text-color);
        }

        /* === 已完成任务的圆弧区域 === */
        #done-container {
            position: absolute;
            bottom: -100px; /* 将圆心移出屏幕下方，形成拱形 */
            right: 50%; 
            transform: translateX(50%); /* 居中 */
            width: 600px;
            height: 600px;
            pointer-events: none; /* 不影响上方点击 */
            z-index: 0;
            /* border: 1px dashed red; 调试用 */ 
        }

        .done-item {
            position: absolute;
            left: 50%;
            top: 50%;
            transform-origin: 0 0; /* 旋转中心 */
            white-space: nowrap;
            font-size: 14px;
            color: #aaa;
            text-decoration: line-through;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
        }

        .done-item.visible {
            opacity: 1;
        }

        .done-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: var(--done-color);
            border-radius: 50%;
            margin-right: 8px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body>

    <!-- 左侧：随意挪动的便签 -->
    <div id="left-area">
        <div class="sticky-note" id="myNote">
            <div class="note-header">按住此处拖动</div>
            <textarea class="note-content" id="noteText" placeholder="在这里写下你的想法..."></textarea>
        </div>
    </div>

    <!-- 右侧：每日Todo -->
    <div id="right-area">
        <!-- 右上角日期 -->
        <div class="header-bar">
            <input type="date" id="date-picker">
        </div>

        <!-- 输入框 -->
        <div class="todo-input-container">
            <input type="text" id="new-todo" placeholder="添加今日待办 (按回车确认)...">
        </div>

        <!-- 待办列表 -->
        <ul id="todo-list">
            <!-- 任务会添加在这里 -->
        </ul>

        <!-- 已完成圆弧容器 -->
        <div id="done-container"></div>
    </div>

    <script>
        // === 1. 日期初始化 ===
        const datePicker = document.getElementById('date-picker');
        const today = new Date().toISOString().split('T')[0];
        datePicker.value = today;

        // 监听日期变化
        datePicker.addEventListener('change', (e) => {
            loadData(e.target.value);
        });

        // === 2. 拖拽便签逻辑 ===
        const note = document.getElementById('myNote');
        const header = note.querySelector('.note-header');
        let isDragging = false;
        let startX, startY, initialLeft, initialTop;

        header.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            const rect = note.getBoundingClientRect();
            // 获取当前对于父容器的相对位置
            initialLeft = note.offsetLeft;
            initialTop = note.offsetTop;
            
            note.style.zIndex = 100;
            document.body.style.cursor = 'move';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            note.style.left = `${initialLeft + dx}px`;
            note.style.top = `${initialTop + dy}px`;
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            document.body.style.cursor = 'default';
            saveData(); // 拖动结束后保存位置
        });

        // 便签内容改变保存
        document.getElementById('noteText').addEventListener('input', saveData);


        // === 3. 待办事项逻辑 ===
        const todoInput = document.getElementById('new-todo');
        const todoList = document.getElementById('todo-list');
        const doneContainer = document.getElementById('done-container');

        let todos = [];

        todoInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && todoInput.value.trim() !== "") {
                addTodo(todoInput.value);
                todoInput.value = '';
            }
        });

        function addTodo(text, isDone = false) {
            const todo = {
                id: Date.now() + Math.random(),
                text: text,
                done: isDone
            };
            todos.push(todo);
            render();
            saveData();
        }

        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.done = !todo.done; // 这里简单处理，实际上UI只支持未完成->完成
                render();
                saveData();
            }
        }

        function render() {
            // 清空列表
            todoList.innerHTML = '';
            doneContainer.innerHTML = '';

            const activeTodos = todos.filter(t => !t.done);
            const doneTodos = todos.filter(t => t.done);

            // 渲染未完成列表
            activeTodos.forEach(t => {
                const li = document.createElement('li');
                li.className = 'todo-item';
                li.innerHTML = `
                    <div class="checkbox" onclick="toggleTodo(${t.id})"></div>
                    <span class="todo-text">${t.text}</span>
                `;
                todoList.appendChild(li);
            });

            // 渲染已完成圆弧
            renderArc(doneTodos);
        }

        function renderArc(doneItems) {
            const radius = 250; // 半径
            const startAngle = -160; // 起始角度 (左下)
            const endAngle = -20;   // 结束角度 (右下)
            const totalAngle = endAngle - startAngle;
            
            // 无论多少个任务，都在圆弧上均匀分布，或者按固定步长
            // 这里使用固定步长堆叠，更像“做完了累积起来”
            const step = 20; // 每个任务占的角度

            doneItems.forEach((item, index) => {
                const el = document.createElement('div');
                el.className = 'done-item';
                el.innerHTML = `<span class="done-dot"></span>${item.text}`;
                
                // 计算角度：从左边开始堆叠
                // 修正：为了让文字在圆弧外侧直立，需要一些数学变换
                // 这里简单使用 rotate
                let angle = startAngle + (index * step);
                if (angle > endAngle) angle = endAngle + (index * 5); // 防止溢出太多

                // 核心变换：
                // 1. 旋转到对应角度
                // 2. 向外平移半径距离 (translateY -radius)
                // 3. 此时文字是倒的或者歪的，如果想让文字水平，比较复杂。
                // 这里采用放射状排列：
                
                el.style.transform = `rotate(${angle}deg) translateY(-${radius}px)`;
                
                // 延时显示动画
                setTimeout(() => el.classList.add('visible'), 50 * index);
                
                doneContainer.appendChild(el);
            });
        }

        // === 4. 数据存储 (LocalStorage) ===
        function saveData() {
            const currentDate = datePicker.value;
            const data = {
                todos: todos,
                noteContent: document.getElementById('noteText').value,
                notePos: {
                    left: note.style.left,
                    top: note.style.top
                }
            };
            localStorage.setItem('dashboard_' + currentDate, JSON.stringify(data));
        }

        function loadData(date) {
            const saved = localStorage.getItem('dashboard_' + date);
            if (saved) {
                const data = JSON.parse(saved);
                todos = data.todos || [];
                document.getElementById('noteText').value = data.noteContent || "";
                if (data.notePos) {
                    note.style.left = data.notePos.left || "100px";
                    note.style.top = data.notePos.top || "100px";
                }
            } else {
                // 如果当天没数据，重置
                todos = [];
                document.getElementById('noteText').value = "";
                // 便签位置不重置，保留用户习惯可能更好，这里简单重置内容
            }
            render();
        }

        // 初始化加载
        loadData(today);

    </script>
</body>
</html>
