<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…¨å¹³å°Â·çµæ„Ÿç©ºé—´</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --note-color: #fff7d1;
            --note-shadow: rgba(0,0,0,0.1);
            --text-color: #333;
            --accent-color: #6c5ce7;
            --done-color: #a29bfe;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            /* é»˜è®¤ç”µè„‘ç«¯ï¼šå·¦å³å¸ƒå±€ */
            flex-direction: row; 
        }

        /* === å·¦ä¾§åŒºåŸŸ (ä¾¿ç­¾) === */
        #left-area {
            flex: 1;
            position: relative;
            border-right: 1px dashed #ccc;
            background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
            background-size: 20px 20px;
            overflow: hidden; /* é˜²æ­¢ä¾¿ç­¾æ‹–å‡ºå»å¤ªè¿œ */
        }

        .sticky-note {
            position: absolute;
            /* åˆå§‹ä½ç½®å±…ä¸­ä¸€ç‚¹ */
            top: 50px;
            left: 50px;
            width: 260px;
            height: 280px;
            background-color: var(--note-color);
            box-shadow: 5px 5px 15px var(--note-shadow);
            border-radius: 2px 2px 15px 2px;
            display: flex;
            flex-direction: column;
            transform: rotate(-2deg);
            z-index: 10;
        }

        .note-header {
            height: 35px;
            background-color: rgba(0,0,0,0.05);
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 12px;
            user-select: none;
            touch-action: none; /* å…³é”®ï¼šç¦æ­¢æµè§ˆå™¨é»˜è®¤çš„æ»šåŠ¨è¡Œä¸º */
        }
        
        .note-header:active {
            cursor: grabbing;
        }

        .note-content {
            flex: 1;
            padding: 15px;
            border: none;
            outline: none;
            resize: none;
            background: transparent;
            font-size: 16px;
            line-height: 1.5;
            color: #444;
        }

        /* === å³ä¾§åŒºåŸŸ (å¾…åŠ) === */
        #right-area {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 30px;
            background-color: white;
            z-index: 5;
        }

        .header-bar {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        #date-picker {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
            font-size: 14px;
        }

        .todo-input-container { margin-bottom: 15px; }
        
        #new-todo {
            width: 100%;
            padding: 12px 5px;
            font-size: 16px;
            border: none;
            border-bottom: 2px solid #eee;
            outline: none;
            border-radius: 0; /* iOSåœ†è§’å»é™¤ */
        }
        
        #new-todo:focus { border-bottom-color: var(--accent-color); }

        #todo-list {
            list-style: none;
            padding: 0;
            margin: 0;
            flex: 1;
            overflow-y: auto; /* åˆ—è¡¨è¿‡é•¿å¯æ»šåŠ¨ */
            padding-bottom: 100px; /* ç»™ä¸‹æ–¹åœ†å¼§ç•™ç©ºé—´ */
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .checkbox {
            min-width: 22px;
            height: 22px;
            border: 2px solid #ccc;
            border-radius: 4px;
            margin-right: 12px;
            cursor: pointer;
        }

        /* === åœ†å¼§å®ŒæˆåŒº === */
        #done-container {
            position: absolute;
            bottom: -80px;
            right: 50%;
            transform: translateX(50%);
            width: 500px;
            height: 400px;
            pointer-events: none;
            z-index: 0;
            /* border: 1px solid red; */
        }

        .done-item {
            position: absolute;
            left: 50%;
            top: 60%; /* è°ƒæ•´åœ†å¿ƒä½ç½® */
            transform-origin: 0 0;
            white-space: nowrap;
            font-size: 12px;
            color: #aaa;
            text-decoration: line-through;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .done-item.visible { opacity: 1; }
        .done-dot { display: inline-block; width: 6px; height: 6px; background: var(--done-color); border-radius: 50%; margin-right: 5px; }

        /* ========================================= */
        /* ğŸ“± ç§»åŠ¨ç«¯é€‚é… (Media Queries) */
        /* ========================================= */
        @media (max-width: 768px) {
            body {
                flex-direction: column; /* æ”¹ä¸ºä¸Šä¸‹å¸ƒå±€ */
            }

            /* ä¸ŠåŠéƒ¨åˆ†ï¼šä¾¿ç­¾åŒº (å å±å¹• 35%) */
            #left-area {
                flex: none;
                height: 35vh;
                width: 100%;
                border-right: none;
                border-bottom: 1px dashed #ccc;
                background-size: 15px 15px;
            }

            .sticky-note {
                width: 200px;
                height: 180px;
                /* ç§»åŠ¨ç«¯åˆå§‹ä½ç½®å±…ä¸­ */
                left: 50% !important; 
                top: 20px !important;
                margin-left: -100px; /* é…åˆleft:50%å±…ä¸­ */
                transform: rotate(-1deg);
            }

            /* ä¸‹åŠéƒ¨åˆ†ï¼šæ¸…å•åŒº (å å±å¹• 65%) */
            #right-area {
                flex: 1;
                padding: 20px;
                border-radius: 20px 20px 0 0; /* é¡¶éƒ¨åœ†è§’ï¼ŒåƒæŠ½å±‰ */
                box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            }

            /* åœ†å¼§åŒºåœ¨æ‰‹æœºä¸Šç¼©å°ï¼Œé¿å…æŒ¡ä½å¤ªå¤š */
            #done-container {
                transform: translateX(50%) scale(0.7);
                bottom: -120px;
            }
            
            /* ä¼˜åŒ–æ‰‹æœºè§¦æ‘¸ä½“éªŒ */
            .checkbox {
                min-width: 25px;
                height: 25px; /* æ”¾å¤§ç‚¹å‡»åŒºåŸŸ */
            }
        }
    </style>
</head>
<body>

    <!-- åŒºåŸŸ1ï¼šä¾¿ç­¾ -->
    <div id="left-area">
        <div class="sticky-note" id="myNote">
            <div class="note-header">ğŸ‘† æŒ‰ä½é¡¶éƒ¨æ‹–æ‹½</div>
            <textarea class="note-content" id="noteText" placeholder="å†™ç‚¹æƒ³æ³•..."></textarea>
        </div>
    </div>

    <!-- åŒºåŸŸ2ï¼šæ¸…å• -->
    <div id="right-area">
        <div class="header-bar">
            <input type="date" id="date-picker">
        </div>

        <div class="todo-input-container">
            <input type="text" id="new-todo" placeholder="æ·»åŠ å¾…åŠ...">
        </div>

        <ul id="todo-list"></ul>
        
        <div id="done-container"></div>
    </div>

    <script>
        // === 1. é€šç”¨é€»è¾‘ (æ—¥æœŸ/Todo) ===
        const datePicker = document.getElementById('date-picker');
        datePicker.value = new Date().toISOString().split('T')[0];

        datePicker.addEventListener('change', (e) => loadData(e.target.value));

        // === 2. å…¨å…¼å®¹æ‹–æ‹½é€»è¾‘ (æ”¯æŒé¼ æ ‡ & æ‰‹æŒ‡) ===
        const note = document.getElementById('myNote');
        const header = note.querySelector('.note-header');
        
        // å˜é‡
        let isDragging = false;
        let startX, startY, initialLeft, initialTop;

        // ç»Ÿä¸€å¤„ç†åæ ‡è·å–
        function getClientPos(e) {
            if (e.touches && e.touches.length > 0) {
                return { x: e.touches[0].clientX, y: e.touches[0].clientY };
            }
            return { x: e.clientX, y: e.clientY };
        }

        function startDrag(e) {
            isDragging = true;
            const pos = getClientPos(e);
            startX = pos.x;
            startY = pos.y;
            
            // è·å–å½“å‰çš„ offsetLeft/Top
            // æ³¨æ„ï¼šåœ¨ç§»åŠ¨ç«¯å› ä¸ºç”¨äº† margin-left å±…ä¸­ï¼Œè®¡ç®—éœ€è¦å°å¿ƒï¼Œè¿™é‡Œç›´æ¥è¯»å½“å‰è®¡ç®—åçš„å€¼
            const rect = note.getBoundingClientRect();
            const parentRect = note.parentElement.getBoundingClientRect();
            
            // è½¬æ¢ä¸ºç›¸å¯¹äºçˆ¶å®¹å™¨çš„åæ ‡
            initialLeft = note.offsetLeft;
            initialTop = note.offsetTop;
            
            note.style.transition = 'none'; // æ‹–åŠ¨æ—¶å…³é—­åŠ¨ç”»ï¼Œæ›´è·Ÿæ‰‹
            note.style.zIndex = 100;
            
            // åªæœ‰é¼ æ ‡éœ€è¦è®¾å…‰æ ‡ï¼Œæ‰‹æœºä¸éœ€è¦
            if(!e.touches) document.body.style.cursor = 'move';
        }

        function onDrag(e) {
            if (!isDragging) return;
            
            // é˜»æ­¢é»˜è®¤æ»šåŠ¨ (æ‰‹æœºä¸Šå¾ˆé‡è¦)
            if (e.cancelable) e.preventDefault();

            const pos = getClientPos(e);
            const dx = pos.x - startX;
            const dy = pos.y - startY;
            
            // æ›´æ–°ä½ç½®
            // ä¸ºäº†ä¿æŒç§»åŠ¨ç«¯ margin-left çš„å±…ä¸­é€»è¾‘ï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹ left/top
            note.style.left = `${initialLeft + dx}px`;
            note.style.top = `${initialTop + dy}px`;
            
            // ç§»åŠ¨ç«¯å¦‚æœæ‰‹åŠ¨æ‹–åŠ¨äº†ï¼Œå»ºè®®æ¸…é™¤ margin-left ä»¥å…è®¡ç®—æ··ä¹±
            if(window.innerWidth <= 768) {
                note.style.marginLeft = '0px';
            }
        }

        function endDrag() {
            if(isDragging) {
                isDragging = false;
                document.body.style.cursor = 'default';
                note.style.transition = 'box-shadow 0.2s';
                saveData(); // ä¿å­˜æœ€ç»ˆä½ç½®
            }
        }

        // ç»‘å®šé¼ æ ‡äº‹ä»¶ (ç”µè„‘)
        header.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', onDrag);
        document.addEventListener('mouseup', endDrag);

        // ç»‘å®šè§¦æ‘¸äº‹ä»¶ (æ‰‹æœº)
        header.addEventListener('touchstart', startDrag, {passive: false});
        document.addEventListener('touchmove', onDrag, {passive: false});
        document.addEventListener('touchend', endDrag);


        // === 3. ä¸šåŠ¡é€»è¾‘ (Todo & Storage) ===
        // æ³¨æ„ï¼šä¸ºäº†ä¿è¯æ¼”ç¤ºç¨³å®šï¼Œè¿™é‡Œé»˜è®¤ä½¿ç”¨ LocalStorageã€‚
        // å¦‚æœä½ éœ€è¦ä¹‹å‰çš„ JSONBin äº‘åŒæ­¥ï¼Œç›´æ¥æŠŠé‚£ä¸ª fetchCloudData å‡½æ•°å¤åˆ¶å›æ¥è°ƒç”¨å³å¯ã€‚
        
        const todoInput = document.getElementById('new-todo');
        const todoList = document.getElementById('todo-list');
        const doneContainer = document.getElementById('done-container');
        let todos = [];

        todoInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && todoInput.value.trim() !== "") {
                addTodo(todoInput.value);
                todoInput.value = '';
            }
        });

        // ç›‘å¬è¾“å…¥æ¡†å¤±ç„¦ï¼ˆæ‰‹æœºä¸ŠæŒ‰å®Œé€šå¸¸ä¼šæ”¶èµ·é”®ç›˜ï¼Œè¿™é‡Œå¤„ç†ä¸€ä¸‹ï¼‰
        todoInput.addEventListener('blur', saveData);

        function addTodo(text) {
            todos.push({ id: Date.now(), text: text, done: false });
            render();
            saveData();
        }

        window.toggleTodo = function(id) {
            const t = todos.find(x => x.id === id);
            if(t) { t.done = !t.done; render(); saveData(); }
        }

        function render() {
            todoList.innerHTML = '';
            doneContainer.innerHTML = '';
            
            todos.filter(t => !t.done).forEach(t => {
                const li = document.createElement('li');
                li.className = 'todo-item';
                li.innerHTML = `<div class="checkbox" onclick="toggleTodo(${t.id})"></div><span>${t.text}</span>`;
                todoList.appendChild(li);
            });

            renderArc(todos.filter(t => t.done));
        }

        function renderArc(items) {
            const radius = 200; // ç¼©å°åŠå¾„ä»¥é€‚åº”ç§»åŠ¨ç«¯
            const startAngle = -150;
            const endAngle = -30;
            const step = 18;

            items.forEach((item, idx) => {
                const el = document.createElement('div');
                el.className = 'done-item';
                el.innerHTML = `<span class="done-dot"></span>${item.text}`;
                
                let angle = startAngle + (idx * step);
                if(angle > endAngle) angle = endAngle + (idx * 5);

                el.style.transform = `rotate(${angle}deg) translateY(-${radius}px)`;
                setTimeout(() => el.classList.add('visible'), 50 * idx);
                doneContainer.appendChild(el);
            });
        }

        // æ•°æ®å­˜å‚¨
        function saveData() {
            const data = {
                todos: todos,
                noteContent: document.getElementById('noteText').value,
                // è®°å½•ä½ç½®ï¼ˆå¯é€‰ï¼Œæ‰‹æœºç«¯ä½ç½®å’ŒPCç«¯ä½ç½®ä¸åŒæ­¥å¯èƒ½æ›´å¥½ï¼Œè¿™é‡Œç®€å•å­˜å‚¨ï¼‰
                notePos: { left: note.style.left, top: note.style.top } 
            };
            localStorage.setItem('app_v2_' + datePicker.value, JSON.stringify(data));
        }

        function loadData(date) {
            const saved = localStorage.getItem('app_v2_' + date);
            if (saved) {
                const data = JSON.parse(saved);
                todos = data.todos || [];
                document.getElementById('noteText').value = data.noteContent || "";
                // åªæœ‰åœ¨éç§»åŠ¨ç«¯ï¼Œæˆ–è€…ç¡®å®æœ‰ä¿å­˜åæ ‡æ—¶æ‰æ¢å¤åæ ‡
                // é˜²æ­¢PCçš„åæ ‡(left:800px)åœ¨æ‰‹æœºä¸Šçœ‹ä¸è§
                if (data.notePos && window.innerWidth > 768) {
                     note.style.left = data.notePos.left;
                     note.style.top = data.notePos.top;
                }
            } else {
                todos = [];
                document.getElementById('noteText').value = "";
                // é‡ç½®ä¾¿ç­¾ä½ç½®
                note.style.left = window.innerWidth > 768 ? '50px' : '50%';
                note.style.top = window.innerWidth > 768 ? '50px' : '20px';
                if(window.innerWidth <= 768) note.style.marginLeft = '-100px';
            }
            render();
        }

        // ä¾¿ç­¾å†…å®¹ä¿å­˜
        document.getElementById('noteText').addEventListener('input', saveData);

        // å¯åŠ¨
        loadData(datePicker.value);

    </script>
</body>
</html>
